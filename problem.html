<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
    }

    .body {
      width: 100%;
      text-align: center;
      padding-top: 100px;
    }

    label {
      display: block;
    }

    label input {
      display: inline-block;
      background: transparent;
      border: 1px solid #969696;
      padding: 10px 20px;
      margin: 10px;
    }

    #result {
      box-sizing: border-box;
      width: 100%;
      word-break: break-all;
      padding: 20px 10% 100px;
    }

  </style>
</head>
<body>
<div class="body">
  如： <br/>
  第3行，第2列，值为2。<br/>
  第4行，第2列，值为3。<br/>
  第5行，第3列，值为6。<br/>
  <label for="n">行:<input id="n" name="n" type="number" max="100000">(n >= 1)</label>
  <label for="m">列:<input id="m" name="m" type="number" max="100000">(m >= 1)</label>
  <button id="getResult">获取结果</button>
  <div id="result"></div>
</div>
<script>
  window.onload = function () {
    let nDom = document.querySelector('#n')
    let mDom = document.querySelector('#m')
    let getResultDom = document.querySelector('#getResult')
    let resultField = document.querySelector('#result')

    getResultDom.addEventListener('click', getResult)

    function getResult() {
      let n = parseInt(nDom.value)
      let m = parseInt(mDom.value)
      if (n < 1 || m < 1 || n < m) {
        resultField.innerHTML = 'error, 数值不合法, 行列值都必须大于0，且行必须大于等于列'
      } else {
        console.log(n, m)
        resultField.innerHTML = `第${n}行，第${m}列的值为:<br/>${multiplyLoop(n, m)}`
      }
      return
    }
  }

  // 大数(Arr)乘以整数
  function multiplyOneArr(parsedNumber, n) {
    let carry = 0
    for (let i = parsedNumber.length - 1; i >= 0; i--) {
      let multiplied = parsedNumber[i] * n + carry
      parsedNumber[i] = multiplied % 10
      carry = Math.floor(multiplied / 10)
    }
    if (carry) {
      let carryStr = carry + ''
      for (let i = carryStr.length - 1; i >= 0; i--) {
        parsedNumber.unshift(parseInt(carryStr[i]))
      }
      // parsedNumber.unshift(carry)
    }
    return parsedNumber
  }

  // 获取(end!)被n整除的次数

  function getNu(end, n) {
    if (!end || !n) {
      throw new Error('getNu required 2 arguments!')
    }
    let nu = 0
    if (end < n) return 0
    while (end > 1) {
      end = Math.floor(end / n)
      nu += end
    }
    return nu
  }

  // 求n以内的所有质数
  function getPrime(n) {
    let primes = [2]
    for (let i = 3, j; i <= n; i++) {
      for (j = 0; j < primes.length; j++) {
        if (i % primes[j] === 0) {
          break;
        }
      }
      if (j === primes.length) {
        primes.push(i)
      }
    }
    return primes
  }

  // 统计每个质数的个数
  function getcount(primes, n, m) {
    let countMap = {}
    let n_m = n - m
    for (let i = 0; i < primes.length; i++) {
      // 可优化?
      countMap[primes[i]] = getNu(n, primes[i]) - getNu(n_m, primes[i]) - getNu(m, primes[i])
    }
    return countMap
  }

  function getPrimeCount(n, m) {
    return getcount(getPrime(n), n, m)
  }

  function multiplyLoop(n, m) {
    // 排除错误数据
    if (0 > m || 0 > n || m > n) {
      return 0
    }
    if (m === 1) {
      return '1'
    }
    if (m === n) {
      return '1'
    }
    n -= 1
    m -= 1
    // 对称，简化计算
    if (m > n / 2) {
      m = n - m
    }

    let data = getPrimeCount(n, m)
    let result = [1]
    for (let i in data) {
      if (data[i] > 1) {
        result = multiplyOneArr(result, Math.pow(parseInt(i), data[i]))
      } else if (data[i] === 1) {
        result = multiplyOneArr(result, parseInt(i))
      }
    }
    return result.join('')
  }
</script>

</body>
</html>